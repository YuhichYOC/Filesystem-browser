{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Image View</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
          rel="stylesheet">
    <link href="{% static 'browse.css' %}" rel="stylesheet" type="text/css">
</head>
<body>
<div class="container-fluid p-5">
    <div class="row my-1">
        {% include 'filesystem/breadcrumb.html' with directory=document %}
    </div>
{% if document.type == 'image' %}
    <div class="row d-flex flex-fill justify-content-center my-1">
        <img src="{{ document.image }}" alt="{{ document.name }}">
    </div>
{% endif %}
{% if document.type == 'pdf' %}
    <div class="row d-flex flex-fill justify-content-center my-1">
        <span class="my-1">
            <input type="button" class="resize-font-xxl" value="Previous" onclick="pageFeed(pageNumber - 1);">
            <input type="button" class="resize-font-xxl" value="Next" onclick="pageFeed(pageNumber + 1);">
            <input type="button" class="resize-font-xxl" value="↻" onclick="rotateRight90();">
            <input type="button" class="resize-font-xxl" value="↺" onclick="rotateLeft90();">
        </span>
        <canvas id="pdf-canvas" class="col-12" style="border: solid black 1px;"></canvas>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <script src="{% static 'browse.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        let p;
        let pageNumber = 1;
        var rotation = 0;
        const url = "{% static document.name %}";
        const pdfCanvas = PdfCanvas(window, url);
        pdfCanvas.load();
        
        function pageFeed(i) {
            pageNumber = 1 > i ? 1 : i;
            pdfCanvas.feed(pageNumber);
        }
        
        function rotateLeft90() {
            rotation = rotation === 0 ? 270 : rotation - 90;
            pdfCanvas.feed(pageNumber);
        }
        
        function rotateRight90() {
            rotation = rotation === 270 ? 0 : rotation + 90;
            pdfCanvas.feed(pageNumber);
        }
    </script>
{% endif %}
{% if document.type == 'media' %}
    <div class="row d-flex flex-fill justify-content-center my-1">
        <video controls style="width: 100%;">
            <source src="{% static document.name %}">
        </video>
    </div>
{% endif %}
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        type="text/javascript"></script>
</body>
</html>